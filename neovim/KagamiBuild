# Description: Fork of Vim aiming to improve user experience, plugins, and GUIs	
# URL:         https://neovim.io/	
# Maintainer:  no one, is ok	
# Depends on:  gperf cmake ninja unzip libuv libtermkey libvterm msgpack	

 name=neovim	
version=0.3.8	
release=1	
backup=('etc/xdg/nvim/sysinit.vim')	
source=("https://github.com/neovim/neovim/archive/v$version.tar.gz")	

 build() {	
	case "$BARCH" in	
		riscv32|riscv64|s390x)	
			die "Not supported on your architecture"	
			;;	
	esac	

 	unset CC CXX	

 	cd "$SRC"/$name-$version	
	mkdir .deps	
	cd .deps	
	cmake "$SRC"/$name-$version/third-party \	
		-DUSE_BUNDLED_GPERF=OFF \	
		-DUSE_BUNDLED_LIBTERMKEY=OFF \	
		-DUSE_BUNDLED_LIBUV=OFF \	
		-DUSE_BUNDLED_LIBVTERM=OFF \	
		-DUSE_BUNDLED_MSGPACK=OFF \	
		-DUSE_BUNDLED_UNIBILIUM=OFF \	
		-Wno-dev -G Ninja	
	ninja	

 	cd "$SRC"/$name-$version	
	mkdir build	
	cd build	
	cmake "$SRC"/$name-$version \	
		-DCMAKE_INSTALL_PREFIX=/usr \	
		-DCMAKE_INSTALL_LIBDIR=/usr/lib \	
		-DCMAKE_BUILD_TYPE=MinSizeRel \	
		-Wno-dev -G Ninja	
	ninja	
	DESTDIR="$PKG" ninja install	

 	install -Dm644 runtime/nvim.desktop "$PKG"/usr/share/applications/nvim.desktop	
	install -Dm644 runtime/nvim.png "$PKG"/usr/share/pixmaps/nvim.png
	alias vim="nvim"
	alias vi="nvim"
	echo "alias vim='nvim'" >> /etc/profile
	echo "alias vi='nvim'" >> /etc/profile
}
